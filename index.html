<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…ÙˆÙ‚Ø¹ÙŠ Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body style="font-family: sans-serif; direction: rtl; text-align: center;">

  <h1>Ø±ØµÙŠØ¯Ùƒ: <span id="points">0</span> Ù†Ù‚Ø·Ø©</h1>
  <input type="text" id="telegramId" placeholder="Ø£Ø¯Ø®Ù„ Telegram ID">
  <button onclick="saveUser()">Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
  <hr>

  <h2>ğŸ“¢ Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
  <p>Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ Ù…ÙˆÙ‚Ø¹ ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</p>
  <hr>

  <h2>ğŸ¯ Ø§Ù„Ù…Ù‡Ù…Ø§Øª</h2>
  <button onclick="earnPoints()">Ø´Ø§Ù‡Ø¯ ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø±Ø¨Ø­ 50 Ù†Ù‚Ø·Ø©</button>

  <script>
    // Ø±Ø¨Ø· Supabase
    const SUPABASE_URL = "https://ulmawlwxrbtojwpviaju.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVsbWF3bHd4cmJ0b2p3cHZpYWp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxMTg4MDMsImV4cCI6MjA3MTY5NDgwM30.AfuqZawzxqNxJ3d7H8PTB7ywRb_YpWEvFQH9HHZvDJ8";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let currentUser = null;

    async function saveUser() {
      const telegramId = document.getElementById("telegramId").value;
      if (!telegramId) {
        alert("Ø£Ø¯Ø®Ù„ Telegram ID");
        return;
      }

      // ØªØ­Ù‚Ù‚ ÙˆØ§Ø´ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯
      let { data: users } = await supabase
        .from("users")
        .select("*")
        .eq("telegram_id", telegramId)
        .single();

      if (!users) {
        // Ø¥Ø°Ø§ Ù…Ø§ÙƒØ§ÙŠÙ†Ø´ØŒ Ù†Ø¯ÙŠØ± Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ø¯ÙŠØ¯
        let { data, error } = await supabase
          .from("users")
          .insert([{ telegram_id: telegramId, points: 0 }]);

        if (error) {
          alert("Ø®Ø·Ø£: " + error.message);
          return;
        }
        currentUser = { telegram_id: telegramId, points: 0 };
      } else {
        currentUser = users;
      }

      document.getElementById("points").innerText = currentUser.points;
      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨!");
    }

    async function earnPoints() {
      if (!currentUser) {
        alert("Ø£Ø¯Ø®Ù„ Telegram ID Ø£ÙˆÙ„Ø§!");
        return;
      }

      const newPoints = currentUser.points + 50;

      let { data, error } = await supabase
        .from("users")
        .update({ points: newPoints })
        .eq("telegram_id", currentUser.telegram_id);

      if (error) {
        alert("Ø®Ø·Ø£: " + error.message);
        return;
      }

      currentUser.points = newPoints;
      document.getElementById("points").innerText = currentUser.points;
      alert("Ø±Ø¨Ø­Øª 50 Ù†Ù‚Ø·Ø©!");
    }
  </script>
</body>
</html>
